<?php

class PartidaController
{

    private $presenter;
    private $model;

    public function __construct($presenter, $model){
        $this->presenter = $presenter;
        $this->model = $model;
    }

    public function show() {
        SessionHelper::verificarSesion();
        $idUsuario = $_SESSION['user_id']; //Esto es para poder mandarle el usuario al modelo y que le dé una pregunta customizada

        // Obtener la pregunta actual desde el modelo
//        $data['preguntaActual'] = $this->model->getPregunta();
        $data['preguntaActual'] = array(
            "id_pregunta" => 56,
            "contenido" => "Cual es la pelicula mas taquillera de todos los tiempos",
            "categoria" => "Entretenimiento",
            "nivel_dificultad" => "Media",
            "opcion_a" => "Avatar",
            "opcion_b" => "Titanic",
            "opcion_c" => "Avengers Endgame",
            "opcion_d" => "Star Wars The Force Awakens",
            "respuesta_correcta" => "C",
            "creada_por" => 6,
            "estado_aprobacion" => "Aprobada",
            "veces_respondida" => 0,
            "veces_respondida_correctamente" => 0,
            "fecha_creacion" => "2024-10-23 11:12:11"
        );

//        if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST['respuesta'])) {
//            $data = $this->validarRespuesta($data, $idUsuario);
//        } else {
//            // Si no se envió ninguna respuesta, recargar solo con la pregunta
//            $data['resultado'] = "";
//        }

        // Mostrar la vista con los datos
        $this->presenter->show('crearPartida', $data);
    }

    public function validarRespuesta($data, $idUsuario)
    {
        $respuestaCorrecta = $data['pregunta']['respuesta_correcta'];
        $respuestaSeleccionada = $_POST['respuesta'];

        if ($respuestaSeleccionada == $respuestaCorrecta) {
            $this->model->sumarPuntos($idUsuario);
            $data['resultado'] = "correcta";
        } else {
            $data['resultado'] = "incorrecta";
        }

        $data['respuestaSeleccionada'] = $respuestaSeleccionada;

        return $data;
    }


}